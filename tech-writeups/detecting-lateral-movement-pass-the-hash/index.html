<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anish - detecting-lateral-movement-pass-the-hash</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/monokai.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #1e1e2e;
            color: #e0e0e0;
            font-family: 'Courier New', monospace;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.05;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .back-link {
            color: #5bc0de;
            text-decoration: none;
            padding: 10px;
            display: block;
            transition: all 0.3s ease;
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        .back-link:hover {
            color: #ff6b6b;
            text-shadow: 0 0 5px rgba(255, 107, 107, 0.5);
        }

        .terminal-window {
            background: #2a2a3a;
            border: 2px solid #5bc0de;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 0 15px rgba(91, 192, 222, 0.2);
        }

        .terminal-header {
            background: #3a3a4a;
            padding: 10px;
            border-bottom: 1px solid #5bc0de;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .terminal-dots {
            display: flex;
            gap: 5px;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .dot.red { background: #ff5f56; }
        .dot.yellow { background: #ffbd2e; }
        .dot.green { background: #27ca3f; }

        .terminal-title {
            color: #a0a0a0;
            font-size: 14px;
        }

        .terminal-content {
            padding: 20px;
        }

        .terminal-content pre {
            background: #1e1e2e;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }

        .terminal-content code {
            font-family: 'Courier New', monospace;
        }

        .terminal-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .terminal-content th, .terminal-content td {
            border: 1px solid #5bc0de;
            padding: 10px;
            text-align: left;
        }

        .terminal-content th {
            background: #3a3a4a;
            color: #e0e0e0;
        }

        .terminal-content td {
            background: #2a2a3a;
        }

        .prompt {
            color: #5bc0de;
            margin-bottom: 10px;
        }

        .command {
            color: #ff6b6b;
        }

        h1 {
            color: #e0e0e0;
            font-weight: normal;
            text-shadow: 0 0 5px rgba(91, 192, 222, 0.3);
            font-size: 2.2em;
            text-align: center;
            margin-bottom: 20px;
        }

        h2, h3 {
            color: #e0e0e0;
            font-weight: normal;
            margin-bottom: 10px;
        }

        hr {
            border: 0;
            border-top: 1px solid #5bc0de;
            margin: 10px 0 20px 0;
            opacity: 0.5;
        }

        @keyframes glow {
            from { text-shadow: 0 0 5px rgba(91, 192, 222, 0.3); }
            to { text-shadow: 0 0 10px rgba(91, 192, 222, 0.5); }
        }

        .footer {
            text-align: center;
            padding: 20px;
            border-top: 1px solid #5bc0de;
            margin-top: 50px;
            color: #a0a0a0;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.8em;
                margin-bottom: 15px;
            }

            h2, h3 {
                margin-bottom: 8px;
            }

            hr {
                margin: 8px 0 15px 0;
            }

            .terminal-content table {
                font-size: 0.9em;
            }
        }

        .matrix-char {
            position: absolute;
            color: #5bc0de;
            font-family: monospace;
            font-size: 14px;
            animation: matrix-fall linear infinite;
        }

        @keyframes matrix-fall {
            0% { opacity: 1; transform: translateY(-100vh); }
            100% { opacity: 0; transform: translateY(100vh); }
        }
    </style>
</head>
<body>
    <canvas class="matrix-bg" id="matrixCanvas"></canvas>

    <div class="container">
        <a href="https://anish7600.github.io/tech-writeups" class="back-link">← Back</a>
        
        <h1>detecting-lateral-movement-pass-the-hash</h1>
        <hr>

        <div class="terminal-window">
            <div class="terminal-header">
                <div class="terminal-dots">
                    <div class="dot red"></div>
                    <div class="dot yellow"></div>
                    <div class="dot green"></div>
                </div>
                <div class="terminal-title">~/technical-writeups/detecting-lateral-movement-pass-the-hash/index.sh</div>
            </div>
            <div class="terminal-content">
                <p><a href="https://anish7600.github.io/technical-writeups" style="text-decoration: none;">← Back</a></p>
<h2>Detecting Lateral Movement and Pass-the-Hash Attacks in Networks</h2><hr>
<p>Lateral movement and Pass-the-Hash (PtH) attacks are key tactics used by attackers after initial compromise to escalate privileges, access sensitive resources, and spread through an environment. Understanding and detecting these behaviors is critical for defending modern enterprise networks.</p>
<hr />
<h3><strong>1. What is Lateral Movement?</strong></h3><hr>
<p>Lateral movement refers to techniques attackers use to navigate through systems within a network after gaining initial access. Their goal is often to gain elevated privileges or access high-value assets (e.g., domain controllers).</p>
<p><strong>Key Lateral Movement Techniques:</strong></p>
<ul>
<li>Credential dumping and reuse</li>
<li>Windows Remote Management (WinRM), PsExec</li>
<li>RDP (Remote Desktop Protocol)</li>
<li>SMB and WMI abuse</li>
<li>SSH pivoting in Unix-like systems</li>
</ul>
<hr />
<h3><strong>2. What is Pass-the-Hash (PtH)?</strong></h3><hr>
<p>Pass-the-Hash is a credential replay attack where an attacker uses stolen hashed credentials (typically NTLM hashes on Windows) to authenticate against other systems without cracking them.</p>
<p><strong>How it works:</strong></p>
<ul>
<li>Extract NTLM hashes from a compromised system (using tools like Mimikatz)</li>
<li>Reuse the hash to authenticate via SMB or RDP on other machines</li>
<li>No need to know the actual password</li>
</ul>
<hr />
<h3><strong>3. MITRE ATT\&amp;CK Techniques for Reference</strong></h3><hr>
<table>
<thead>
<tr>
<th>Technique</th>
<th>ID</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Credential Dumping</td>
<td>T1003</td>
<td>Collecting account credentials, often to facilitate PtH</td>
</tr>
<tr>
<td>Remote Services</td>
<td>T1021</td>
<td>Use of protocols like RDP, SMB for lateral movement</td>
</tr>
<tr>
<td>Pass-the-Hash</td>
<td>T1550.002</td>
<td>Use of hashed credentials for authentication</td>
</tr>
<tr>
<td>Internal Reconnaissance</td>
<td>T1018</td>
<td>Discovering internal systems and trust relationships</td>
</tr>
</tbody>
</table>
<hr />
<h3><strong>4. Indicators of Lateral Movement</strong></h3><hr>
<ul>
<li><strong>Logons from unusual sources</strong> (new IPs, user workstations logging onto servers)</li>
<li><strong>Abnormal use of admin tools</strong> (PsExec, WMI, WinRM)</li>
<li><strong>Kerberos ticket anomalies</strong> (unusual ticket-granting behavior)</li>
<li><strong>High volume of SMB traffic</strong></li>
<li><strong>Execution of remote commands</strong></li>
</ul>
<hr />
<h3><strong>5. Detection Strategies</strong></h3><hr>
<h4>a. <strong>SIEM-Based Detection</strong></h4>
<ul>
<li>
<p>Correlate Windows Event Logs:</p>
</li>
<li>
<p>Event ID 4624 (successful logon)</p>
</li>
<li>Event ID 4672 (special privileges assigned)</li>
<li>Event ID 4688 (process creation)</li>
<li>
<p>Alert on:</p>
</li>
<li>
<p>Multiple logons from the same source to different machines</p>
</li>
<li>Use of hashes as authentication material</li>
<li>Remote execution utilities</li>
</ul>
<h4>b. <strong>Honeypots and Canary Accounts</strong></h4>
<ul>
<li>Set up decoy user accounts or systems to trap attackers during lateral movement.</li>
</ul>
<h4>c. <strong>Behavioral Anomaly Detection</strong></h4>
<ul>
<li>Use User and Entity Behavior Analytics (UEBA) to spot deviations from baseline activities.</li>
</ul>
<h4>d. <strong>Endpoint Detection and Response (EDR) Tools</strong></h4>
<ul>
<li>Tools like Microsoft Defender for Endpoint, CrowdStrike, SentinelOne can detect suspicious token use and credential reuse.</li>
</ul>
<hr />
<h3><strong>6. Defense and Mitigation</strong></h3><hr>
<ul>
<li><strong>Enforce least privilege</strong>: Limit lateral movement by restricting admin access.</li>
<li><strong>Credential hygiene</strong>: Avoid credential reuse, disable legacy protocols like NTLM.</li>
<li><strong>Enable Credential Guard</strong>: Protect LSASS memory in Windows.</li>
<li><strong>Segment the network</strong>: Isolate systems to limit movement scope.</li>
<li><strong>Log and alert</strong> on suspicious authentication and remote execution behavior.</li>
<li><strong>Patch regularly</strong>: Prevent attackers from exploiting known vulnerabilities for pivoting.</li>
</ul>
<hr />
<h3><strong>7. Tools for Detection and Response</strong></h3><hr>
<ul>
<li><strong>Sysmon</strong>: Log detailed system activity for correlation</li>
<li><strong>Mimikatz</strong>: Use in red team to test your defenses</li>
<li><strong>BloodHound</strong>: Map out Active Directory attack paths</li>
<li><strong>Wireshark + Zeek</strong>: Monitor lateral movement traffic patterns</li>
<li><strong>Elastic Stack</strong>: Use ELK for deep log analysis</li>
</ul>
<hr />
<h3><strong>Conclusion</strong></h3><hr>
<p>Detecting lateral movement and Pass-the-Hash attacks requires a combination of strong logging, behavioral analysis, privilege control, and proactive threat hunting. Incorporating these detections into your security posture significantly increases your ability to stop an attacker before they reach critical assets.</p>
            </div>
        </div>

        <div class="footer">
            <div class="prompt">root@writeup:~$ <span class="command">echo "End of transmission"</span></div>
            <p>&copy; 2025 Anish. All rights reserved.</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Highlight.js
            hljs.highlightAll();

            const canvas = document.getElementById('matrixCanvas');
            if (!canvas) {
                console.error('Canvas element not found');
                return;
            }
            const ctx = canvas.getContext('2d');
            if (!ctx) {
                console.error('Canvas context not available');
                return;
            }

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!@#$%^&*()_+-=[]{}|;:,.<>?';
            const charArray = chars.split('');
            const fontSize = 14;
            const columns = Math.floor(canvas.width / fontSize);
            const drops = Array(columns).fill(1);

            function draw() {
                ctx.fillStyle = 'rgba(30, 30, 46, 0.04)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#5bc0de';
                ctx.font = `${fontSize}px monospace`;

                for (let i = 0; i < drops.length; i++) {
                    const text = charArray[Math.floor(Math.random() * charArray.length)];
                    ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                    if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                        drops[i] = 0;
                    }
                    drops[i]++;
                }
            }

            setInterval(draw, 35);

            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
        });
    </script>
</body>
</html>
